<div *ngIf="report">
  <div class="summary w-full flex justify-between mb-6">
    <div class="summary__cell bg-blue-100">
      <div class="summary__count text-blue-900 bg-opacity-40">{{ report.report.length }}</div>
      <div class="summary__title">rows</div>
    </div>
    <div class="summary__cell bg-green-100" (click)="toggleFilter('succeed')">
      <div
        class="summary__icon summary__icon--succeed"
        [ngClass]="{
          'summary__icon--active': isActive('succeed')
        }"
      >
        <ng-container *ngTemplateOutlet="filter"></ng-container>
      </div>
      <div class="summary__count text-green-600">
        {{ report.report.length - suspiciousCount - failedCount }}
      </div>
      <div class="summary__title">succeed</div>
    </div>
    <div class="summary__cell bg-red-100" (click)="toggleFilter('failed')">
      <div
        class="summary__icon summary__icon--failed"
        [ngClass]="{
          'summary__icon--active': isActive('failed')
        }"
      >
        <ng-container *ngTemplateOutlet="filter"></ng-container>
      </div>
      <div class="summary__count text-red-600">{{ failedCount }}</div>
      <div class="summary__title">failed</div>
    </div>
    <div class="summary__cell bg-yellow-100" (click)="toggleFilter('suspicious')">
      <div
        class="summary__icon summary__icon--suspicious"
        [ngClass]="{
          'summary__icon--active': isActive('suspicious')
        }"
      >
        <ng-container *ngTemplateOutlet="filter"></ng-container>
      </div>
      <div class="summary__count text-yellow-600">{{ suspiciousCount }}</div>
      <div class="summary__title">suspicious</div>
    </div>
  </div>

  <table class="br-table">
    <colgroup>
      <col span="1" style="min-width: 320px" />
      <col span="1" style="min-width: 24px" />
      <col span="1" style="width: 100%" />
    </colgroup>
    <thead>
      <tr>
        <th>row id</th>
        <th></th>
        <th>status</th>
      </tr>
    </thead>
    <tbody>
      <ng-container *ngFor="let row of data$ | async">
        <tr
          (click)="onClickRow($event, row)"
          [ngClass]="{
            expandable: !isHealty(row.status)
          }"
        >
          <td>{{ row.id }}</td>
          <td>
            <ng-container
              *ngIf="!isHealty(row.status)"
              [ngTemplateOutlet]="expander"
            ></ng-container>
          </td>
          <td>
            <div *ngIf="isFailed(row.status)">
              <div class="status status--failed">Has failed features</div>
            </div>
            <div *ngIf="isSuspicious(row.status)">
              <div class="status status--susp">Has suspicious features</div>
            </div>
            <div class="status status--succeed" *ngIf="isHealty(row.status)">Healthy</div>
          </td>
        </tr>
        <tr>
          <td colspan="3">
            <div>
              <table class="checks">
                <colgroup>
                  <col span="1" style="min-width: 160px" />
                  <col span="1" style="min-width: 160px" />
                  <col span="1" style="min-width: 160px" />
                  <col span="1" style="width: 100%" />
                </colgroup>
                <thead>
                  <tr>
                    <th>feature</th>
                    <th>status</th>
                    <th>metric</th>
                    <th>description</th>
                  </tr>
                </thead>
                <tbody>
                  <ng-container *ngFor="let feature of row.features_checks | keyvalue">
                    <tr *ngFor="let check of feature.value">
                      <td>{{ feature.key }}</td>
                      <td>
                        <div class="status status--failed" *ngIf="check.status === 'failed'">
                          failed
                        </div>
                        <div class="status status--susp" *ngIf="check.status === 'suspicious'">
                          suspicious
                        </div>
                      </td>
                      <td>{{ check.metric_type }}</td>
                      <td>{{ check.description }}</td>
                    </tr>
                  </ng-container>
                </tbody>
              </table>
            </div>
          </td>
        </tr>
      </ng-container>
    </tbody>
  </table>

  <ng-template #filter>
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="h-6 w-6"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"
      />
    </svg>
  </ng-template>
</div>

<ng-template #expander>
  <svg
    xmlns="http://www.w3.org/2000/svg"
    class="h-6 w-6"
    fill="none"
    viewBox="0 0 24 24"
    stroke="currentColor"
    class="expander"
  >
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
  </svg>
</ng-template>
